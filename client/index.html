<html ng-app = "myApp">
	<head>

	    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
	    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.min.js"></script>

	     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtQqXjYkxVtjQgirqKLZkiL1WeqWXOrZc&libraries=places"></script>
    	<link rel = 'stylesheet' type = 'text/css' href = 'static/style.css'>
	    <script>

	    	var myAppDB = angular.module('myApp', ['ngRoute']);
	    	myAppDB.config(function ($routeProvider) {
		     $routeProvider
		        .when('/login',{
		            templateUrl: 'partials/login.html'
		        })
		         .when('/',{
		            templateUrl: 'partials/country.html'
		        })
		        .otherwise({
		          redirectTo: '/'
		        });
		      });

	    	myAppDB.factory('tweetFactory',function ($http){
	    		var tweets = [];
	    		var factory = {};
	    		
	    		factory.getTweets = function(tweet, callback){
	    			console.log(tweet)
	    			$http.post('/tweets', tweet).success(function(output){
	    				// console.log(output)
	    				tweets = output
	    				callback(tweets)
	    			})
	    		}  		
	    		return factory;
	    	}) 

	    	myAppDB.factory('userFactory',function ($http){
	    	  var factory = {};
			  
			  factory.login = function(info){
			    return $http.post('/login', info).success(function(data){

			    });
			  };

			  factory.register = function(info){
			  	// console.log(info)
			    return $http.post('/register', info).success(function(data){

			    });
			  };	    		
	 		
	    		return factory;
	    	})	    	

	    	myAppDB.controller('tweetsController', function($scope, tweetFactory){
	    		$scope.tweets = [];

	    		$scope.addTweets = function(data){
	    			console.log($scope.newTweet)
	    			tweetFactory.getTweets($scope.newTweet, function(data){
	    				$scope.tweets = data
	    				console.log(data)
	    				// console.log($scope.tweets.twitter.statuses[0].user)
	    			})
	    		}

	   	 	})

	    	myAppDB.controller('usersController', function($scope, tweetFactory, $location, userFactory){
	    		  $scope.user = {};
				  $scope.loggedIn = false;
				  $scope.show_registration = false;

				  $scope.registerUser = function(){
				  	console.log("in usersController resgisterUser method")
				    userFactory.register($scope.new_user).error(function(error){
				      if (typeof error === 'string'){
				        $scope.error = "Your username/email already exists.";
				        $scope.newUser.password = "";
				        $scope.newUser.password_confirm = "";
				      }
				      else{
				        $scope.error = error;
				        $scope.newUser.password = "";
				        $scope.newUser.password_confirm = "";
				      }
				    }).then(function(){
				      $location.path('/');
				    });
				  };


				  $scope.loginUser = function(){
				    userFactory.login($scope.login_user).error(function(error){
				      $scope.error = error;
				    }).then(function(){
				      $location.path('/');
				    });
				  };
				})
	
	   	 	


	    </script>
	</head>
	<body>
		
		
			<div ng-view="">
        	</div>
		
	</body>
</html>